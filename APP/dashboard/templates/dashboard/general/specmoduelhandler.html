{% extends 'dashboard/base.html'%}
{%load static%}
{%load general%}
{%block page_name%}
Moduel Selection and ordering
{%endblock%}
{%block content%}
{%definevar context.spec as spec %}
{%definevar context.sample_obj as sample %}
{%include 'dashboard/general/items/specmoduel_actions.html'%}
{%definevar 'specmoduel' as alert_loc%}
{%include 'base/alert.html'%}
<script src='https://cdnjs.cloudflare.com/ajax/libs/dragula/3.7.3/dragula.min.js'></script>


<div class="mb-4">
	<div class="card-body">
		<div class="card shadow mb-4">
			<div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
				<h5 class="h4 mb-1 text-primary font-weight-bold">
					Quick Content Editing
				</h5>
			</div>
			<div class="card-body">
				<div class='spec_organiser_container_notice' id='spec_organiser_container_notice'>
					Please Use a desktop on chrome to make your specification, or zoom out.
				</div>
				<select class="form-select form-control mb-3" id='edit_chapter_select'>
				{%for chapter in context.all_chapters%}
				<option value="{%url 'content:noteedit' context.spec.id chapter.p_moduel chapter.p_chapter%}[sep]{%url 'content:questionedit' context.spec.id chapter.p_moduel chapter.p_chapter%}">
					{{chapter.p_moduel|field_name_to_label}} - {{chapter.p_chapter|field_name_to_label}}
					{%if chapter.is_completed_content%}
					&#x2705;
					{%else%}
					&#x2715;
					{%endif%}
					{%if chapter.is_completed_questions%}
					&#x2705;
					{%else%}
					&#x2715;
					{%endif%}
					</option>
				{%endfor%}
				</select>
				
				<button id='note_edit_button' type= 'submit' class='btn btn-primary mb-2' style='float-right'>  <i class="bi bi-pencil-square"></i> Edit Content </button>
				<button id='question_edit_button' type= 'submit' class='btn btn-primary mb-2' style='float-right'>  <i class="bi bi-pencil-square"></i> Edit Questions </button>
			</div>
		</div>
	</div>
</div>
<script>
var note_edit_button= document.getElementById("note_edit_button");
note_edit_button.addEventListener("click", Redirect_FN_Note);
var question_edit_button= document.getElementById("question_edit_button");
question_edit_button.addEventListener("click", Redirect_FN_Question);
function Redirect_FN_Note() {
	var select_element = document.getElementById("edit_chapter_select");
	var urls = select_element.options[ select_element.selectedIndex ].value
	urls = urls.split('[sep]')
	var note_edit_url = urls[0]
	window.open(note_edit_url, '_blank').focus();
}
function Redirect_FN_Question() {
	var select_element = document.getElementById("edit_chapter_select");
	var urls = select_element.options[ select_element.selectedIndex ].value
	urls = urls.split('[sep]')
	var question_edit_url = urls[1]
	window.open(question_edit_url, '_blank').focus();

}

</script>


<div style='margin:auto; padding:15px;' class='mb-3 mt-5' id='marketcourse_courseoutline'>
	<h1 class='font-weight-bold' style='margin:auto;' > <i class="bi bi-journal-text"></i> Course Outline </h1>
	<div class='mt-2' style=''>
		{%definevar context.spec.spec_content as content%}
		{%include 'dashboard/general/items/outline_item_moveable.html'%}
	</div>
</div>

<div class="mb-4">
	<div class="card-body">
		<div class="card shadow mb-4">
			<div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
				<h5 class="h4 mb-1 text-primary font-weight-bold">
					Modules for: {{spec.spec_level}} {{spec.spec_subject}} {{spec.spec_board}} {{spec.spec_name}}
				</h5>
					
				<div class="dropdown no-arrow">
					<a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink"
						data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
						<i class="fas fa-ellipsis-v fa-sm fa-fw text-primary-400"></i>
					</a>
					<div class="dropdown-menu dropdown-menu-right shadow animated--fade-in"
						aria-labelledby="dropdownMenuLink">
						<div class="dropdown-header">Specification Actions:</div>
						<a type="button" class="dropdown-item" href='{%url "dashboard:specificationoutline" spec.id%}'>
							View outline
						</a>
						<a type="button" class="dropdown-item" data-toggle="modal" data-target="#InheritModal">
							Inherit
						</a>
						<a type="button" class="dropdown-item" data-toggle="modal" data-target="#RenameModal">
							Rename Specification
						</a>
						<a type="button" class="dropdown-item" data-toggle="modal" data-target="#CrateModuelModal">
							Create New Module
						</a>
						<a type="button" class="dropdown-item text-danger" data-toggle="modal" data-target="#DeleteModuleModal">
							Delete Module
						</a>
					</div>
				</div>
			</div>
			<div class="card-body">
				<div class='spec_organiser_container_notice' id='spec_organiser_container_notice'>
					Please Use a desktop on chrome to make your specification, or zoom out.
				</div>
				<div class='spec_organiser_container shadow' id='spec_organiser_container' style='text-align:center;margin-left:50px;'>
					<ol class='list' id='right'>
						{%for obj in context.moduels%}
						<li class='child shadow' value='{{obj.p_moduel}}'>
							<input type='hidden' name='ordered_items[]' value='{{obj.p_moduel}}'/>
							<span class='handle mr-1 ml-1'style='font-size:25px;'>
								+
							</span>
							<a style='text-decoration:none'>
							{{obj.p_moduel|field_name_to_label}}
							</a>
						</li >
						{%endfor%}
					</ol>

					<form class="list user px-3 py-3"  action="{%url 'content:_ordermoduels'%}" method="POST" role="form">
						{%csrf_token%}
						<button type= 'submit' class='btn btn-primary mb-2' style='float-right'> Save </button>
						<input type='hidden' name='level' value='{{spec.spec_level}}'/>
						<input type='hidden' name='subject' value='{{spec.spec_subject}}'/>
						<input type='hidden' name='board' value='{{spec.spec_board}}'/>
						<input type='hidden' name='name' value='{{spec.spec_name}}'/>
						<br>
						<input type="checkbox" name="completed" value="1" 
						{%if context.spec_completion%}
						checked
						{%endif%}
						>
						<label for="completed">Completed ? </label><br>
						<ol class = 'list' id='left' style='height:1000px;'>
							{%for obj in context.specification_moduels%}
							<li class='child shadow' value='{{obj.p_moduel}}'>
								<input type='hidden' name='ordered_items[]' value='{{obj.p_moduel}}'/>
								<span class='handle mr-1 ml-1'style='font-size:25px;'>
									+
								</span>
							<a href='{%url 'dashboard:specchapter' spec.spec_level spec.spec_subject spec.spec_board spec.spec_name obj.p_moduel%}' target='_blank'>
							{{obj.p_moduel|field_name_to_label}}
							</a>
							</li>
							{%endfor%}
						</ol>
					</form>
				</div>
			</div>
		</div>
	</div>
</div>




<script>
dragula([document.getElementById('left'), document.getElementById('right')], {
  moves: function (el, container, handle) {
    return handle.classList.contains('handle');
  },
  copy: function (el, source) {
    return source === document.getElementById(left)
  },
  accepts: function (el, target) {
    return target !== document.getElementById(left)
  },
});
</script>
{%endblock%}
